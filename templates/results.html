{% extends "base.html" %}

{% macro page_url(p) -%}
  {{ url_for('search',
             q=original_query,
             mode=last_mode,
             limit=limit,
             page=p) }}
{%- endmacro %}

{% block content %}
  <main class="main">
    <div class="notice success">üîé K·∫øt qu·∫£ t√¨m ki·∫øm <strong>{{ shown_query }}</strong></div>
    {% if shown_query != original_query %}
      <a class="search-instead" href="{{ url_for('search_instead', q=original_query) }}">T√¨m ki·∫øm thay th·∫ø cho: <strong>{{ original_query }}</strong></a>
    {% endif %}

    <div class="results-header">
    <span class="results-count">T·ªïng: <strong>{{ total }}</strong> b√†i vi·∫øt</span>

    {% if total_pages > 1 %}
    <nav class="paginator">
      {% if page > 1 %}
        <a class="page-btn" href="{{ page_url(page-1) }}">&laquo; Tr∆∞·ªõc</a>
      {% else %}
        <span class="page-btn disabled">&laquo; Tr∆∞·ªõc</span>
      {% endif %}

      {% set start = 1 if page-2 < 1 else page-2 %}
      {% set end = total_pages if page+2 > total_pages else page+2 %}

      {% if start > 1 %}
        <a class="page-btn" href="{{ page_url(1) }}">1</a>
        {% if start > 2 %}<span class="page-ellipsis">‚Ä¶</span>{% endif %}
      {% endif %}

      {% for p in range(start, end + 1) %}
        {% if p == page %}
          <span class="page-btn current">{{ p }}</span>
        {% else %}
          <a class="page-btn" href="{{ page_url(p) }}">{{ p }}</a>
        {% endif %}
      {% endfor %}

      {% if end < total_pages %}
        {% if end < total_pages - 1 %}<span class="page-ellipsis">‚Ä¶</span>{% endif %}
        <a class="page-btn" href="{{ page_url(total_pages) }}">{{ total_pages }}</a>
      {% endif %}

      {% if page < total_pages %}
        <a class="page-btn" href="{{ page_url(page+1) }}">Sau &raquo;</a>
      {% else %}
        <span class="page-btn disabled">Sau &raquo;</span>
      {% endif %}
    </nav>
    {% endif %}
  </div>

    {% for r in results %}
      {% set image_url = 'https://baosoctrang.org.vn' ~ (r.get('avatarApp','') if r else '') %}
      {% set page_url  = 'https://baosoctrang.org.vn' ~ (r.get('pageUrl','') if r else '') %}
      <div class="result">
        <div class="result-image">
          {% if image_url %}<img src="{{ image_url }}" alt="thumbnail" />{% endif %}
        </div>
        <div class="result-body">
          <h3 class="result-title"><a href="{{ page_url }}" target="_blank">{{ r['title'] }}</a></h3>
          <p class="result-snippet">{{ (r['content'] or '')[:500] }}...</p>
        </div>
      </div>
      <hr/>
    {% endfor %}
  </main>
{% endblock %}
